"use strict";var passport=require("passport"),FacebookStrategy=require("passport-facebook").Strategy,keys=require("../keys.js"),FacebookUser=require("./facebookModel.js");passport.serializeUser(function(a,b){b(null,a.id)}),passport.deserializeUser(function(a,b){FacebookUser.findById(a).then(function(a){b(null,a)})}),passport.use(new FacebookStrategy({callbackURL:"auth/facebook/callback",clientID:keys.facebook.clientID,clientSecret:keys.facebook.clientSecret},function(a,b,c,d){FacebookUser.findOne({facebookId:c.id}).then(function(a){if(a)d(null,a);else{var b={userEmail:c.email[0].value,facebookId:c.id},e=new FacebookUser(b);e.save().then(function(a){don(null,a)})}}).catch(function(){})}));